# Hack Directory

This directory contains utility scripts that help manage the codebase, check
consistency, autogenerate code, etc. This document documents what each of them do.

---

`hack/verify-fakes.sh`

This script runs as a presubmit and fails if the fake implementations used for
testing need to be updated. If you find your PR is failing because the fakes are
out of date, simply run:

```
make fakes
```

This will regenerate all the mocked implementations, then commit the results.
Also, consider checking the unit tests. If fakes are out of date, then probably
tests need to be adjusted.

`hack/verify-proto.sh`

This script is a presubmit job that checks if the autogenerated code needs to
be rebuilt when the protobuf definitions change. The script has two variables with the pinned
versions of the `protoc` and `protoc-gen-go` tools used to check the code:

```bash
export PROTOC_VER="24.2"
export PROTOC_GO_VER="v1.31.0"
```

If this check fails, ensure the following conditions are met:

1. Ensure the versions of protoc and protoc-ge-go in your machine match
those in `verify-proto.sh` (`protoc-gen-go --version` and `protoc --version`
are your friends here).
2. Run protoc and commit the results:

```
make proto
```

If there are newer versions of `protoc` or `protoc-gen-go`, feel free to use them
instead when generating the code. Just remember to update the variables in the
shell script to make the presubmit pass.
